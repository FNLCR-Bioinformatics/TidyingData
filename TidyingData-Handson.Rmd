---
title: "BTEP-TidyingData-Handson"
author: "Ravi and Randy"
date: "February 26, 2017"
output: html_document
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "H:/2017/BTEP1-TidyingData")
print(getwd())
```

Let us load the libraries
```{r loadlibraries}
library(tidyverse) 
```

## Provide information about the source of the data

Let us read the data. 

## Import functions

We will be using \b{readr} function for this section. 
Note that read_csv is different than read.csv 

- read_csv() comma-sep files
- read_csv2() $;$ separated files
- read_tsv() 
- read_delim()

## Let us do some examples

Watch out how the column names are displayed and additional information 
that you get from read_csv
Also note the number of rows are displayed in read_csv compared to read.csv

```{r}
read_csv("Data/WHO-2a.csv")
read.csv("Data/WHO-2a.csv")
```

What happens if your dataset has a metadata (indicated by \# ) as the first line followed by 
the column names

```{r}
read_csv("Data/WHO-2a.csv", comment = "#")
```

## Why we insist on using readr::read_csv than read.csv?

- Speed (~ 10x)
- output from readr is Tibbles (we talked about earlier)
- Base R taps into OS where it is executed. But readr functions are OS independent and
  hence reproducible
  
## Import Exercise-1

What function would you use to read a file whose fields are separated by \|



```{r readdata}
#wdbc <- read_csv("C:/Users/Ravi/Desktop/BTEP/Data/wdbc.data", col_names = FALSE)

wdbc <- read_csv("Data/wdbc.data", col_names = FALSE)
#wdbctry2 <- read_csv("C:/Users/Ravi/Desktop/BTEP/Data/wdbc.data", header = FALSE)
names(wdbc)
```

Let us add column names

```{r AssignColnams}
cnames <- c("ID", "Diagnosis", 
            "radius", "Texture", "Perimeter", "area",
            "smoothness", "compactness", "concavity", "concave_points",
            "symmetry","fractaldim",
            "radiusSE", "TextureSE", "PerimeterSE", "areaSE",
            "smoothnessSE", "compactnessSE", "concavitySE", "concave_pointsSE",
            "symmetrySE","fractaldimSE",
            "radiusW", "TextureW", "PerimeterW", "areaW",
            "smoothnessW", "compactnessW", "concavityW", "concave_pointsW",
            "symmetryW","fractaldimW")

names(wdbc) <- cnames
```



Basic Usage

```{r}
summary(cars)
```

If you want to just display the code chunk but not the concerned R code, 
you need "echo = FALSE" 
```{r, echo=FALSE}
summary(cars)
```

Plotting in Rmd. If you want the users to see the plot but not the code,
then do the following:

Note the eval=FALSE (upper case; lower case will fail)
```{r, echo=FALSE}
plot(cars)
```

If you want to display the R code without evualating, then use
```{r, eval=FALSE}
summary(cars)
```

What about additional formating when displaying the contens of a table? 
Note the **asis** option
```{r, results='asis'}
knitr::kable(mtcars)
```


## Tibble

What is tibble?

- modern way or loooking at the traditional data.frame 
- you will get a lot more useful information than the data.frames
- tibble is part of tibble package and part of the core tidyverse package
 
To get help, use 
```{r, tibblehelp, eval=FALSE}
?tibble
vignette("tibble")

```

 
How to create a tibble? 
```{r create-tibble}
tibble(
  x = 1:5, 
  y = LETTERS[1:5], 
  z = x^2 + 20
)

```
What is the difference between the R regular data.frame and 
tibble (data_frame)?

```{r TibblevsDataframe}
employee <- c('John Wayne','Peter Doe','Esther Julie')
salary <- c(20000, 23400, 26800)
startdate <- as.Date(c('2016-12-1','2007-3-25','2016-3-14'))
df <- data.frame(employee, salary, startdate)
df

as_tibble(df)

```


you can coerce regular R data frame into tibble. Let us look at the R dataset, cars.
Let us learn about cars datset 
```{r, echo = FALSE}
?cars
```
Let us find out what class cars object belongs to and how to convert cars data frame into
tibbles object. Note that 

```{r coerce-tibble}
class(cars)
as_tibble(cars)
head(cars) #otherwise you get all 50 rows
```

## Why Tibble? 

- Tibble doesnt change the inputs. Ex. strings to factors 
- Doesnt add new names or modify the inputs
- For example, Tibble never converts strings to factors

## What is tribble

- transposed tibble, tribble()
- small data in readable form
- column headings are shown as formulas ( ie ~ )
- nice format
- no need to explicitely use head command (Ex. head cars)


```{r}
tribble(
  ~x, ~y, ~z,
  #--|--|----
  "Male", 187, 210,
  "Female", 190, 150
)
```

Let us create a little bit complicated tibble 
note that lubridate gives the current time

```{r complicatedtibble, results= 'asis'}
t2 <- tibble(
  a = lubridate::now() + runif(1e3) * 86400,
  b = lubridate::today() + runif(1e3) * 30,
  c = 1:1e3,
  d = runif(1e3),
  e = sample(letters, 1e3, replace = TRUE)
)
```


```{r}
t2
```

You can change the defaults of tibble display with options.

```{r}
options(tibble.print_max = 10, tibble.print_min = 6)
t2
```

You can also use the following tibble option to show all columns
```{r, eval=FALSE}
options(tibble.width = Inf)
# more options available at 
package?tibble
```


How to extract the columns or rows of tibble?

```{r}
head(t2$a)

has_name(t2, "b")
getOption("tibble.max_extra_cols")
```

how to add a row of a tibble in a specific place?

original t2 
```{r}
t2
```

```{r ,results='as.is'}
    aa = lubridate::today()
    bb = lubridate::now()
    cc = 1:1
    dd = runif(1)
    ee = sample(letters, 1, replace = TRUE)
    print(aa); print(bb); print(cc); print(dd); print(ee)
t2 %>% 
  add_row(
    a = aa, 
    b = bb,
    c = cc,
    d = dd,
    e = ee, .before = 2  # note the dot in ".before = 2"
)

```
After the change

```{r}
t2
```

## Subsetting 

- \$ by name
-    

```{r}

df <- tibble(
  x = runif(5),
  y = rnorm(5)
)

df$x

df[[1]]
```

Can you use Tibble in a pipeline?

```{r}
df %>% .$x   

df %>% .[["y"]]
```

What happens if tibble doesnt work with a package? 
Transform Tibble back to a data.frame using the following command:
```{r}
as.data.frame(df)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r cars, fig.cap = "cars"}
with(cars, plot(speed,dist))
```

## Tibble Exercise 1

Create a new tibble with the following information:
  name, age, height, weight, smoker (T or F), Male (True or Fale)
 compare the tibble with the R data_frame


## Exercise 2

convert iris data set (given to us in data.frame ) to tibble data_frame


## Exercise 3

How can you tell whether the object is a Tibble or not? 

## Exercise 4 (based on Wickam's book)

Partial matching is a big issue with data.frame.
df <- data.frame(abc = 1, xyz = "a")
df$x
df[, "xyz"]



